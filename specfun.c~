#include <stdio.h>
#include <stdlib.h>
#include <math.h>

double pi = 3.141592653589793238;
double euler = 0.577215664901532860;
double zeta[] = {
1.644934066848226436, //2
1.202056903159594285, //3
1.082323233711138191, //4
1.036927755143369926, //5
1.017343061984449139, //6
1.008349277381922826, //7
1.004077356197944339, //8
1.002008392826082214, //9
1.000994575127818085, //10
1.000494188604119464, //11
1.000246086553308048, //12
1.000122713347578489, //13
1.000061248135058704, //14
1.000030588236307020, //15
1.000015282259408651, //16
1.000007637197637899, //17
1.000003817293264999, //18
1.000001908212716553, //19
1.000000953962033872, //20
1.000000476932986787, //21
1.000000238450502727, //22
1.000000119219925965, //23
1.000000059608189051, //24
1.000000029803503514, //25
1.000000014901554828, //26
1.000000007450711789, //27
1.000000003725334024, //28
1.000000001862659723, //29
1.000000000931327432, //30
};

double lngamma(double x){
  double t=x-1;
  double sum=-log(x)+t*(1-euler);
  double pow=t*t;
  int n;
  for(n=2; n<=30; n++){
    sum+=(zeta[n-2]-1)*pow/n;
    pow*=(-t);
  }  
  return sum;
}

double eulergamma(double x){
  if((x<=0.0)&&(round(x)==x)){
    printf("Error: argument of gamma cannot be zero or negative integer\n");
    exit(0);
  }
  if(x>1.5) return (x-1)*gamma(x-1);
  if(x<0.5) return gamma(x+1)/x;
  return exp(lngamma(x));
}

long long int fact(int n){
  int i;
  long long int fact=1;
  for(i=2; i<=n; i++) fact*=2;
  return fact;
}

double besselJ(double nu,double x){
  double next,sum;
  int m;
  if((nu<0)&&(round(nu)==nu))
    if(((int)round(nu))%2==1) return -besselJ(-nu,x);
      else return besselJ(-nu,x);
  if(x==0.0) return 0.0;
  next=exp(log(x/2)*nu)/eulergamma(nu+1);
  sum=next;
  for(m=1; m<1000; m++){
    next*=(-1)*(x*x/4)/(m*(m+nu));
    sum+=next;
  }
  return sum;
}

int main(int argc,char *argv[]){
  if(argc<2){
    printf("Usage:\ngamma x(double)\n");
    printf("beta x(double) y(double)\n");
    printf("besselJ nu(double) x(double)\n");
    printf("besselY nu(double) x(double)\n");
    printf("besselI nu(double) x(double)\n");
    printf("besselK nu(double) x(double)\n");
    return 0;
  }
  if(strcmp(argv[1],"gamma")==0){
    double x=atof(argv[2]);
    printf("gamma(%s) = %.17lf\n",argv[2],eulergamma(x));
  }
  if(strcmp(argv[1],"besselJ")==0){
    double nu=atof(argv[2]);
    double x=atof(argv[3]);
    printf("besselJ(%s,%s) = %.17lf\n",argv[2],argv[3],besselJ(nu,x));
  }
  return 0;
}






